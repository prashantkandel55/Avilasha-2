# Avilasha PocketBase Server

This directory contains the PocketBase server configuration for the Avilasha application. PocketBase provides real-time database functionality, authentication, file storage, and an admin dashboard.

## Setup Instructions

### 1. Using Docker (Recommended)

The easiest way to run PocketBase is using Docker with the provided `docker-compose.yml` file.

```bash
# From the root directory of the project
docker-compose up -d
```

This will start PocketBase on port 8090. The admin dashboard will be available at http://localhost:8090/_/.

### 2. Manual Setup

If you prefer not to use Docker, you can download PocketBase directly:

1. Download the latest version of PocketBase for your platform from [PocketBase Releases](https://github.com/pocketbase/pocketbase/releases)
2. Extract the executable to this directory
3. Run PocketBase:

```bash
# Windows
./pocketbase.exe serve

# macOS/Linux
./pocketbase serve
```

## Initial Configuration

### Admin Account Setup

1. Access the admin dashboard at http://localhost:8090/_/
2. Create a new admin account with:
   - Email: admin@avilasha.com
   - Password: adminpassword123
   
### Database Initialization

After setting up the admin account, you can initialize the database with the schema and sample data:

1. Install required dependencies:

```bash
npm install axios
```

2. Run the initialization script:

```bash
node init.js
```

This script will:
- Create the necessary collections based on the schema
- Create a demo user (email: demo@example.com, password: password)
- Populate the tokens collection with data from CoinGecko

## Database Schema

The Avilasha application uses the following collections:

1. **users** - User accounts and profiles
2. **tokens** - Cryptocurrency token data
3. **portfolio** - User's token holdings
4. **transactions** - Record of buy/sell transactions
5. **wallets** - User's cryptocurrency wallets
6. **notifications** - System notifications for users

See `pb_schema.json` for the complete schema definition.

## API Endpoints

PocketBase automatically generates RESTful API endpoints for all collections. The base URL for API requests is:

```
http://localhost:8090/api/
```

### Authentication Endpoints

- `POST /api/collections/users/auth-with-password` - Login with email/password
- `POST /api/collections/users/auth-refresh` - Refresh authentication token
- `POST /api/collections/users/request-password-reset` - Request password reset

### Collection Endpoints

For each collection, the following endpoints are available:

- `GET /api/collections/{collection}/records` - List records
- `GET /api/collections/{collection}/records/{id}` - Get a single record
- `POST /api/collections/{collection}/records` - Create a record
- `PATCH /api/collections/{collection}/records/{id}` - Update a record
- `DELETE /api/collections/{collection}/records/{id}` - Delete a record

## Real-time Subscriptions

PocketBase supports real-time subscriptions via WebSockets. The client SDK provides methods to subscribe to collection changes.

Example:

```javascript
// Subscribe to changes in the tokens collection
pb.collection('tokens').subscribe('*', function(e) {
  console.log(e.action); // "create", "update", or "delete"
  console.log(e.record); // the affected record
});
```

## File Storage

Files (such as user avatars) are automatically stored by PocketBase and can be accessed via URLs generated by the SDK.

Example:

```javascript
// Get the URL for a user's avatar
const avatarUrl = pb.getFileUrl(userRecord, userRecord.avatar);
```

## Additional Resources

- [PocketBase Documentation](https://pocketbase.io/docs/)
- [PocketBase JavaScript SDK](https://github.com/pocketbase/js-sdk)
